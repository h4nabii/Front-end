<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        .box {
            width: 300px;
            border: 1px solid #999;
            padding: 10px;
            min-height: 400px;
        }

        * {
            margin: 0;
            padding: 0;
        }

        .emsInfo {
            margin-top: 20px;
        }

        .emsInfo li {
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <h2>9971121346085</h2>
    <div class='box'>
        <input type="text" id='inp'> <button type="button" id='search'>查询</button>
        <ul class='emsInfo'>
            <!-- <li>
                <strong>标题：时间</strong>
                <p>内容：哈哈哈哈付或付或付或付若若女</p>
            </li> -->
        </ul>
    </div>

    <script>
        document.getElementById('search').onclick = function () {
            //获取值
            var inp = document.getElementById('inp').value;
            // console.log(inp);
            if (!inp) {
                document.querySelector('.emsInfo').innerHTML = '输入的内容不能为空';
            } else {
                //创建ajax对象
                var xhr = new XMLHttpRequest();
                xhr.open('get', '07ems.php?code=' + inp, true);
                xhr.send();

                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4) {
                        if (xhr.status == 200) {//成功获取内容
                            console.log(xhr.responseText);
                            var obj = JSON.parse(xhr.responseText);
                            // console.log(obj);
                            //处理的渲染数据----封装出去-----------
                            getData(obj);
                            // //判断查询的物流信息是否是正确的物流单号--
                            if(obj.status==-2){
                                document.querySelector('.emsInfo').innerHTML=obj.msg;
                            }else{
                                //成功查询到物流信息---渲染数据
                                // console.log(obj.data.info.context);
                                var arr=obj.data.info.context;
                                //遍历数组---获取内容数据 --1.空容器   2.for循环+=添加数据
                                var str='';
                                for(var i=0;i<arr.length;i++){
                                    //处理时间格式---把总的秒数--转成年月日 时分秒
                                    // var time=times(arr[i].time);
                                    str+=`<li>
                                            <strong>${times(arr[i].time)}</strong>
                                            <p>${arr[i].desc}</p>
                                        </li>`;
                                }
                                //for结束---打印str
                                // console.log(str);
                                document.querySelector('.emsInfo').innerHTML=str;
                            }
                        }
                    }
                }

            }
        }

        //处理物流信息的方法--------------------------------------------------
        function getData(obj) {
            //判断查询的物流信息是否是正确的物流单号--
            if (obj.status == -2) {
                document.querySelector('.emsInfo').innerHTML = obj.msg;
            } else {
                //成功查询到物流信息---渲染数据
                // console.log(obj.data.info.context);
                var arr = obj.data.info.context;
                //遍历数组---获取内容数据 --1.空容器   2.for循环+=添加数据
                var str = '';
                for (var i = 0; i < arr.length; i++) {
                    //处理时间格式---把总的秒数--转成年月日 时分秒
                    // var time=times(arr[i].time);
                    str += `<li>
                               <strong>${times(arr[i].time)}</strong>
                                 <p>${arr[i].desc}</p>
                            </li>`;
                }
                //for结束---打印str
                // console.log(str);
                document.querySelector('.emsInfo').innerHTML = str;
            }
        }


        //时间处理函数---------------------------------------------------------
        function times(num) {//num 总的秒数 --转毫秒数--转当前的年月日
            var date = new Date(num * 1000);
            // console.log(date);
            var y = date.getFullYear();
            var m = date.getMonth() + 1;
            var day = date.getDate();

            //时分秒--- 12  下午判断
            // console.log(y,m,day);
            //补0操作： 两位数   2015/06/05   下午 04:20:08
            m = m > 9 ? m : '0' + m;
            day = day > 9 ? day : '0' + day;

            return y + '年' + m + '月' + day + '日';
        }

    </script>
</body>

</html>
